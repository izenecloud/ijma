<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Japanese Morphological Analyzer: iJMA Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li class="current"><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>iJMA Library</h1>
<p>
<h3 align="center">1.0 </h3><b>iJMA</b> (iZENEsoft Japanese Morphological Analyzer) is a platform-independent C++ library for Japanese word segmentation and POS tagging. The approach used in iJMA is based on the CRF (Conditional Random Field) statistical model.<p>
<h2>Table of guidance</h2>
<p>
<ul>
<li>
<a href="#interface">How to use the interface</a> </li>
<li>
<a href="#build">How to build and link with the library</a> <ul>
<li>
<a href="#build_linux">Under Linux platform</a> </li>
<li>
<a href="#build_win32">Under Win32 platform</a> </li>
</ul>
</li>
<li>
<a href="#demo">How to run the demo</a> </li>
<li>
<a href="#dictionary">How to use the dictionary</a>  <ul>
<li>
<a href="#sysdict">System dictionary</a> </li>
<li>
<a href="#userdict">User dictionary</a> </li>
<li>
<a href="#load">Run time loading</a> </li>
</ul>
</li>
</ul>
<p>
<h2><a class="anchor" name="interface"></a>How to use the interface</h2>
<p>
<em>Step 1: Include the header files in directory <code>include</code></em> <div class="fragment"><pre class="fragment"><span class="preprocessor">#include "<a class="code" href="jma__factory_8h.html" title="Definition of class JMA_Factory.">jma_factory.h</a>"</span>
<span class="preprocessor">#include "<a class="code" href="analyzer_8h.html" title="Definition of class Analyzer.">analyzer.h</a>"</span>
<span class="preprocessor">#include "<a class="code" href="knowledge_8h.html" title="Definition of class Knowledge.">knowledge.h</a>"</span>
<span class="preprocessor">#include "<a class="code" href="sentence_8h.html" title="Definition of class Sentence.">sentence.h</a>"</span>
</pre></div><p>
<em>Step 2: Use the library name space</em> <div class="fragment"><pre class="fragment"><span class="keyword">using namespace </span>jma;
</pre></div><p>
<em>Step 3: Call the interface and handle the result</em><p>
In the example below, the return value of some functions are not handled for simplicity. In your using, please properly handle those return values in case of failure.<p>
The example code could be available at: <a href="test__jma__run_8cpp-source.html">test_jma_run.cpp</a>.<p>
<div class="fragment"><pre class="fragment"><span class="comment">// create instances</span>
JMA_Factory* factory = JMA_Factory::instance();
Analyzer* analyzer = factory-&gt;createAnalyzer();
Knowledge* knowledge = factory-&gt;createKnowledge();

<span class="comment">// (optional) set character encode type, the default encode type is EUCJP,</span>
<span class="comment">// you could set it as SJIS or UTF8</span>
knowledge-&gt;setEncodeType(Knowledge::ENCODE_TYPE_SJIS);
 
<span class="comment">// set the system dictionary path</span>
knowledge-&gt;setSystemDict(<span class="stringliteral">"db/jumandic/bin_eucjp"</span>);
<span class="comment">// (optional) add the paths of multiple user dictionaries</span>
knowledge-&gt;addUserDict(<span class="stringliteral">"db/userdic/juman_eucjp.csv"</span>);
knowledge-&gt;addUserDict(<span class="stringliteral">"db/userdic/juman_eucjp.txt"</span>);
<span class="comment">// load system and user dictionary files</span>
knowledge-&gt;loadDict();

<span class="comment">// (optional) load stop word dictionary</span>
knowledge-&gt;loadStopWordDict(<span class="stringliteral">"db/stopworddic/test-eucjp.txt"</span>);

<span class="comment">// (optioinal) if Analyzer::splitSentence() would be called,</span>
<span class="comment">// load the sentence separator configuration file in specific encode type</span>
knowledge-&gt;loadSentenceSeparatorConfig(<span class="stringliteral">"db/config/sen-eucjp.config"</span>);

<span class="comment">// (optional) if POS tagging is not necessary,</span>
<span class="comment">// disable the output of POS result when Analyzer::runWith***() is called</span>
analyzer-&gt;setOption(Analyzer::OPTION_TYPE_POS_TAGGING, 0);

<span class="comment">// (optional) output POS result in alphabet format such like "NP-S", instead of in Japanese format</span>
analyzer-&gt;setOption(Analyzer::OPTION_TYPE_POS_FORMAT_ALPHABET, 1);

<span class="comment">// (optional) output POS result in full category of Japanese format,</span>
<span class="comment">// some POS results might include asterisk symbol</span>
analyzer-&gt;setOption(Analyzer::OPTION_TYPE_POS_FULL_CATEGORY, 1);

<span class="comment">// (optional) get 5-best results when Analyzer::runWithSentence() is called</span>
analyzer-&gt;setOption(Analyzer::OPTION_TYPE_NBEST, 5);

<span class="comment">// set knowledge</span>
analyzer-&gt;setKnowledge(knowledge);

<span class="comment">// 0. split paragraphs into sentences</span>
<span class="keywordtype">string</span> line;
vector&lt;Sentence&gt; sentVec;
<span class="keywordflow">while</span>(getline(cin, line)) <span class="comment">// get paragraph string from standard input</span>
{
    sentVec.clear(); <span class="comment">// remove previous sentences</span>
    analyzer-&gt;splitSentence(line.c_str(), sentVec);
    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i&lt;sentVec.size(); ++i)
    {
        analyzer-&gt;runWithSentence(sentVec[i]); <span class="comment">// analyze each sentence</span>
        ...
    }
}

<span class="comment">// 1. analyze a sentence</span>
Sentence s;
s.setString(<span class="stringliteral">"..."</span>);
analyzer-&gt;runWithSentence(s);

<span class="comment">// get one-best result</span>
<span class="keywordtype">int</span> i= s.getOneBestIndex();
...

<span class="comment">// get n-best results</span>
for(<span class="keywordtype">int</span> i=0; i&lt;s.getListSize(); ++i)
{
    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0; j&lt;s.getCount(i); ++j)
    {
        <span class="keyword">const</span> <span class="keywordtype">char</span>* pLexicon = s.getLexicon(i, j);
        <span class="keyword">const</span> <span class="keywordtype">char</span>* strPOS = s.getStrPOS(i, j);
        <span class="comment">// get the base form of the specific Japanese word</span>
        <span class="keyword">const</span> <span class="keywordtype">char</span>* baseForm = s.getBaseForm(i, j);
        <span class="comment">// get the reading form</span>
        <span class="keyword">const</span> <span class="keywordtype">char</span>* readForm = s.getReadForm(i, j);
        ...
    }
    <span class="keywordtype">double</span> score = s.getScore(i);
    ...
}

<span class="comment">// 2. analyze a paragraph</span>
<span class="keyword">const</span> <span class="keywordtype">char</span>* result = analyzer-&gt;runWithString(<span class="stringliteral">"..."</span>);
...

<span class="comment">// 3. analyze a file</span>
analyzer-&gt;runWithStream(<span class="stringliteral">"..."</span>, <span class="stringliteral">"..."</span>);

<span class="comment">// destroy instances</span>
<span class="keyword">delete</span> knowledge;
<span class="keyword">delete</span> analyzer;
</pre></div><p>
<h2><a class="anchor" name="build"></a>How to build and link with the library</h2>
<p>
<a href="http://www.cmake.org">CMake</a> is used as the build system.<p>
<h4><a class="anchor" name="build_linux"></a>Under Linux platform</h4>
<p>
Use script <code>build.sh</code> in directory <code>build</code> like below. <div class="fragment"><pre class="fragment">$ cd build
$ ./build.sh
</pre></div><p>
After the project is built, the library targets <code>libjma.a</code> and <code>libmecab.so</code> are created in directory <code>lib</code>, and the executables in directory <code>bin</code> are created for demo and test.<p>
To link with the library, the user application needs to include header files in directory <code>include</code>, and link the library files <code>libjma.a</code>, <code>libmecab.so</code> in directory <code>lib</code>.<p>
An example of compiling user application <code>test.cpp</code> looks like: <div class="fragment"><pre class="fragment">$ export JMA_PATH=path_of_jma_project
$ g++ -I$JMA_PATH/include -o test test.cpp $JMA_PATH/lib/libjma.a $JMA_PATH/lib/libmecab.so -lpthread -Wl,-rpath,$JMA_PATH/lib
</pre></div><p>
<h4><a class="anchor" name="build_win32"></a>Under Win32 platform</h4>
<p>
Please check that whether <code>Visual Studio 9 2008</code> exists on your Win32 platform. If it does not exist, please install it beforehand. You could also use other Visual Studio version, in which case you need to revise the script <code>build/build.sh</code> to set the value of flag <code>WIN32_BUILD_SYSTEM</code> to your own Visual Studio version.<p>
Then use script <code>build.sh</code> in directory <code>build</code> like below. <div class="fragment"><pre class="fragment">$ cd build
$ ./build.sh release win32
</pre></div><p>
Then the MSVC project file <code>build/temp/JMA.sln</code> is generated, please open and build it inside MSVC IDE. After the project is built, the library targets <code>jma.lib</code>, <code>mecab.lib</code> and <code>mecab.dll</code> are created in directory <code>lib/Release</code>, and the executables in directory <code>bin/Release</code> are created for demo and test.<p>
To link with the library, the user application needs to include header files in directory <code>include</code>, and link the library files <code>jma.lib</code>, <code>mecab.lib</code> in directory <code>lib</code>.<p>
To run the user application, it is also necessary to put <code>mecab.dll</code> in the search path used by Windows to locate it.<p>
<h2><a class="anchor" name="demo"></a>How to run the demo</h2>
<p>
To run the demo <code>bin/jma_run</code>, please make sure the project is built (see <a href="#build">how to build</a>), and also the compiled system dictionary exists on your disk, such like <code>db/jumandic/bin_eucjp</code>.<p>
Below is the demo usage: <div class="fragment"><pre class="fragment">$ cd bin
$ ./jma_run --sentence N-best [--dict DICT_PATH]
$ ./jma_run --<span class="keywordtype">string</span> [--dict DICT_PATH]
$ ./jma_run --stream INPUT OUTPUT [--dict DICT_PATH]
</pre></div><p>
The <code>DICT_PATH</code> is the path of compiled system dictionary, such like <code>db/jumandic/bin_eucjp</code>, which is the default system dictionary used in demo.<p>
Demo of analyzing 5-best results of a sentence string from standard input. <div class="fragment"><pre class="fragment">$ ./jma_run --sentence 5 
</pre></div><p>
Demo of analyzing a paragraph string from standard input. <div class="fragment"><pre class="fragment">$ ./jma_run --<span class="keywordtype">string</span>
</pre></div><p>
To exit the loop in the above demos, please press <code>CTRL-C</code>.<p>
Demo of analyzing file from <code>INPUT</code> to <code>OUTPUT</code>. The example of <code>INPUT</code> file could be available as <code>../db/test/asahi_test_raw_eucjp.txt</code>. <div class="fragment"><pre class="fragment">$ ./jma_run --stream INPUT OUTPUT
</pre></div><p>
The demo source code could be available at: <a href="test__jma__run_8cpp-source.html">test_jma_run.cpp</a>. <br>
<p>
<h2><a class="anchor" name="dictionary"></a>How to use the dictionary</h2>
<p>
<h4><a class="anchor" name="sysdict"></a>System dictionary</h4>
<p>
The CSV files (such like <code>db/jumandic/src/Noun.koyuu.csv</code>) are source files of system dictionary. Whenever the words are revised or added in source files, you need to compile them into binary files like below.<p>
<div class="fragment"><pre class="fragment">$ cd bin
$ mkdir ../db/jumandic/bin_eucjp
$ ./jma_encode_sysdict --encode eucjp ../db/jumandic/src ../db/jumandic/bin_eucjp
</pre></div><p>
In the above example, the character encoding of binary files is set as <code>EUC-JP</code>. For encoding <code>SHIFT-JIS</code> and <code>UTF-8</code>, please use <code>sjis</code> and <code>utf8</code> instead of <code>eucjp</code>.<p>
<h4><a class="anchor" name="userdict"></a>User dictionary</h4>
<p>
The user dictionary (such like <code>db/userdic/juman_eucjp.csv</code> or <code>db/userdic/juman_eucjp.txt</code>) could be loaded at run time without compilation beforehand.<p>
Please note that the character encoding of user dictionary could be configured by the entry <code>dictionary-charset</code> in <code>dicrc</code> file, which is under the directory of compiled system dictionary (such like <code>db/jumandic/bin_eucjp/dicrc</code>).<p>
<h4><a class="anchor" name="load"></a>Run time loading</h4>
<p>
In the example below, call the APIs to load dictionary files at run time.<p>
<div class="fragment"><pre class="fragment"><span class="comment">// set character encode type, for which EUCJP, SJIS or UTF8 are available</span>
knowledge-&gt;setEncodeType(Knowledge::ENCODE_TYPE_EUCJP);
 
<span class="comment">// set the system dictionary path</span>
knowledge-&gt;setSystemDict(<span class="stringliteral">"db/jumandic/bin_eucjp"</span>);

<span class="comment">// add the paths of multiple user dictionaries</span>
knowledge-&gt;addUserDict(<span class="stringliteral">"db/userdic/juman_eucjp.csv"</span>);
knowledge-&gt;addUserDict(<span class="stringliteral">"db/userdic/juman_eucjp.txt"</span>);

<span class="comment">// load system and user dictionary files</span>
<span class="keywordflow">if</span>(knowledge-&gt;loadDict() == 0)
{
    cerr &lt;&lt; <span class="stringliteral">"fail to load dictionary files"</span> &lt;&lt; endl;
    exit(1);
}
</pre></div><p>
<br>
 Copyright (C) 2009, iZENEsoft. All rights reserved. <br>
 Author: Jun &lt;<a href="mailto:jun.zju@gmail.com">jun.zju@gmail.com</a>&gt;, Vernkin &lt;<a href="mailto:vernkin@gmail.com">vernkin@gmail.com</a>&gt; <br>
 Version: 1.0.0 <br>
 Date: 2009-09-30 <br>
 </div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Feb 10 18:03:23 2010 for Japanese Morphological Analyzer by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
